<!DOCTYPE html>
<html>
<head>
  <title>Dog vs Cat Classifier</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.7.4/dist/tf.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    #output { margin-top: 10px; font-size: 1.2em; }
    video { max-width: 100%; }
  </style>
</head>
<body>
  <h1>Dog vs Cat Classification</h1>
  <video id="webcam" autoplay playsinline width="640" height="480"></video>
  <canvas id="canvas" style="display:none;"></canvas>
  <div id="output">Loading model...</div>

  <script>
    async function setupWebcam() {
      const video = document.getElementById('webcam');
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        return new Promise((resolve) => {
          video.onloadedmetadata = () => resolve(video);
        });
      } catch (e) {
        document.getElementById('output').innerText = 'Error accessing webcam: ' + e.message;
        throw e;
      }
    }

    async function loadModel() {
      try {
        const model = await tf.loadGraphModel('https://username.github.io/dog-cat-classifier/model.json');
        document.getElementById('output').innerText = 'Model loaded successfully';
        return model;
      } catch (e) {
        document.getElementById('output').innerText = 'Error loading model: ' + e.message;
        throw e;
      }
    }

    async function predict(model, video, canvas) {
      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      
      const image = tf.browser.fromPixels(canvas)
        .resizeNearestNeighbor([224, 224])
        .toFloat()
        .div(tf.scalar(255.0))
        .expandDims();
      
      const predictions = await model.predict(image).data();
      const labels = ['dog', 'cat'];
      const maxPrediction = Math.max(...predictions);
      const maxIndex = predictions.indexOf(maxPrediction);
      
      document.getElementById('output').innerText = 
        `Prediction: ${labels[maxIndex]} (${(maxPrediction * 100).toFixed(2)}%)`;
      
      tf.dispose(image);
    }

    async function main() {
      try {
        const video = await setupWebcam();
        const model = await loadModel();
        const canvas = document.getElementById('canvas');
        setInterval(() => predict(model, video, canvas), 100);
      } catch (e) {
        console.error(e);
      }
    }

    main();
  </script>
</body>
</html>